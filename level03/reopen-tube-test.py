from pwn import *
import json
import hmac
from hashlib import sha1

############################################################################################################################################################
# CTRL+D, REOPEN EVERYTHING AND TYPING IN TERMINAL AND HAVING SHELL WORKS
# CAN THIS BE DONE WITH PYTHON?
############################################################################################################################################################

# see last stackoverflow
# create files for stdin and stdout and set those for process creation
# hope that we can reopen files with pyhton as well

level = "fusion03"


# fwrite = open("tmpout", "wb")
# fread = open("tmpout", "r")

# err_log_file = open("/home/kali/CLionPrjects/"+level+"/err.log", 'w')
#stdin=fwrite.fileno(),
p = process(["/home/kali/CLionPrjects/"+level+"/cmake-build-debug/"+level])

# p = Popen("/home/kali/CLionPrjects/" + level +"/cmake-build-debug/" + level, stdin = PIPE, stdout = PIPE, stderr = PIPE, bufsize = 1)
# p = Popen("/home/kali/CLionPrjects/" + level +"/cmake-build-debug/" + level, stdin = fread, stdout = fwrite)

print(p.pid)
input("Press Enter to continue...")

p.sendline(b"A"*7)
# p.send(b"\x04")
p.shutdown()
# p.interactive()


# p.stdin = fwrite.fileno()

# hello
print(p.recvline())

# fr.close()
#
# p.sendline(b"B"*7)
# print(p.recvline())
p.interactive()

# pid = process(["pgrep", level]).recvall()
#
#
# payload = b"A"*4
#
# p.send(payload)
# p.shutdown()
#
# log.info("debug msges from local process:")
# try:
#     while True:
#         log.info(p.recvline().replace(b"\n", b""))
#         new_p = p.spawn_process(["/home/kali/CLionPrjects/"+level+"/cmake-build-debug/"+level])
#         new_p.stdin.write("echo hallo\n")
#         print(new_p.stdout.read())
# except EOFError:
#     print("done")






